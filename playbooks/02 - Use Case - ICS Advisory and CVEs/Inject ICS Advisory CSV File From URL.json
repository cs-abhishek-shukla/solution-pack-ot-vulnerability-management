{
    "@type": "Workflow",
    "triggerLimit": null,
    "name": "Inject ICS Advisory CSV File From URL",
    "aliasName": null,
    "tag": null,
    "description": "Retrieve data from URL and create ICS Advisory attachment as per scheduled.",
    "isActive": false,
    "debug": false,
    "singleRecordExecution": false,
    "remoteExecutableFlag": false,
    "parameters": [],
    "synchronous": false,
    "collection": "\/api\/3\/workflow_collections\/d84beded-f595-4e73-90c4-c32992183749",
    "versions": [],
    "triggerStep": "\/api\/3\/workflow_steps\/713337d7-1ce2-4878-b96b-d6531a82c226",
    "steps": [
        {
            "@type": "WorkflowStep",
            "name": "Download File And Create Attachment",
            "description": null,
            "arguments": {
                "params": {
                    "name": "{{vars.steps.Get_Date_from_CSV.data.filename}}",
                    "filename": "\/tmp\/{{vars.steps.Get_Date_from_CSV.data['cyops_file_path']}}",
                    "description": "",
                    "request_headers": "",
                    "multipart_headers": "",
                    "extra_multipart_fields": ""
                },
                "version": "3.2.3",
                "connector": "cyops_utilities",
                "operation": "create_cyops_attachment",
                "operationTitle": "File: Create Attachment from File",
                "step_variables": []
            },
            "status": null,
            "top": "570",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/0109f35d-090b-4a2b-bd8a-94cbc3508562",
            "group": null,
            "uuid": "061f107c-9c52-469e-b27f-9e3bfdf3255b"
        },
        {
            "@type": "WorkflowStep",
            "name": "Update Attachemt With Tags",
            "description": null,
            "arguments": {
                "resource": {
                    "__link": {
                        "recordTags": "{{vars.tagList}}"
                    }
                },
                "operation": "Append",
                "collection": "{{vars.steps.Download_File_And_Create_Attachment.data['@id']}}",
                "__recommend": [],
                "collectionType": "\/api\/3\/attachments",
                "fieldOperation": {
                    "recordTags": "Append"
                },
                "step_variables": []
            },
            "status": null,
            "top": "705",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/b593663d-7d13-40ce-a3a3-96dece928722",
            "group": null,
            "uuid": "19156654-1c95-42bc-b88c-cbb445b2572a"
        },
        {
            "@type": "WorkflowStep",
            "name": "Start",
            "description": null,
            "arguments": {
                "route": "3ce8956b-5671-48e6-97e0-fa8675295fdb",
                "title": "Ingest ICS Advisory",
                "resources": [
                    "i_c_s_advisories"
                ],
                "inputVariables": [],
                "step_variables": {
                    "input": {
                        "params": [],
                        "records": "{{vars.input.records}}"
                    }
                },
                "executeButtonText": "Execute",
                "noRecordExecution": true,
                "singleRecordExecution": false
            },
            "status": null,
            "top": "30",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/f414d039-bb0d-4e59-9c39-a8f1e880b18a",
            "group": null,
            "uuid": "713337d7-1ce2-4878-b96b-d6531a82c226"
        },
        {
            "@type": "WorkflowStep",
            "name": "Get Date from CSV",
            "description": null,
            "arguments": {
                "params": {
                    "url": "https:\/\/raw.githubusercontent.com\/icsadvprj\/ICS-Advisory-Project\/main\/ICS-CERT_ADV\/ICS-CERT_ADV_Master_{{vars.todayDate}}.csv",
                    "password": "",
                    "username": "",
                    "request_headers": ""
                },
                "version": "3.2.3",
                "connector": "cyops_utilities",
                "operation": "download_file_from_url",
                "ignore_errors": true,
                "operationTitle": "File: Download File from URL",
                "step_variables": {
                    "tagList": "{% set tags = [] %}{% set _ = tags.extend((\"ICS - Advisory\", vars.todayDate)) %}{{tags}}"
                }
            },
            "status": null,
            "top": "300",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/0109f35d-090b-4a2b-bd8a-94cbc3508562",
            "group": null,
            "uuid": "b2ae7eea-8a2e-48e1-95b6-2f01b8b26cbc"
        },
        {
            "@type": "WorkflowStep",
            "name": "Configuration",
            "description": null,
            "arguments": {
                "todayDate": "{{arrow.utcnow().format(\"M_DD_YYYY\")}}"
            },
            "status": null,
            "top": "165",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
            "group": null,
            "uuid": "dc0b7dad-8fac-4098-8fe6-2b32c4bdd548"
        },
        {
            "@type": "WorkflowStep",
            "name": "Is Todays CSV File Present",
            "description": null,
            "arguments": {
                "conditions": [
                    {
                        "option": "Yes",
                        "step_iri": "\/api\/3\/workflow_steps\/061f107c-9c52-469e-b27f-9e3bfdf3255b",
                        "condition": "{{ vars.steps.Get_Date_from_CSV.status == \"Success\" }}",
                        "step_name": "Download File And Create Attachment"
                    }
                ]
            },
            "status": null,
            "top": "435",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/12254cf5-5db7-4b1a-8cb1-3af081924b28",
            "group": null,
            "uuid": "ec0a9567-6b5b-4cfc-a111-d90b288f4063"
        }
    ],
    "routes": [
        {
            "@type": "WorkflowRoute",
            "name": "Get Date from CSV -> Is Todays CSV File Present",
            "targetStep": "\/api\/3\/workflow_steps\/ec0a9567-6b5b-4cfc-a111-d90b288f4063",
            "sourceStep": "\/api\/3\/workflow_steps\/b2ae7eea-8a2e-48e1-95b6-2f01b8b26cbc",
            "label": null,
            "isExecuted": false,
            "uuid": "12b974d8-2eed-40d0-ad8f-e1be657aaf5d"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Download File And Create Attachment -> Update Attachemt With Tags",
            "targetStep": "\/api\/3\/workflow_steps\/19156654-1c95-42bc-b88c-cbb445b2572a",
            "sourceStep": "\/api\/3\/workflow_steps\/061f107c-9c52-469e-b27f-9e3bfdf3255b",
            "label": null,
            "isExecuted": false,
            "uuid": "369822a5-0831-481f-a3c8-39a8101664bf"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Configuration -> Get Date from CSV",
            "targetStep": "\/api\/3\/workflow_steps\/b2ae7eea-8a2e-48e1-95b6-2f01b8b26cbc",
            "sourceStep": "\/api\/3\/workflow_steps\/dc0b7dad-8fac-4098-8fe6-2b32c4bdd548",
            "label": null,
            "isExecuted": false,
            "uuid": "3d9159d5-3fb3-4a89-9a2f-c3915753ccb4"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Start -> Configuration",
            "targetStep": "\/api\/3\/workflow_steps\/dc0b7dad-8fac-4098-8fe6-2b32c4bdd548",
            "sourceStep": "\/api\/3\/workflow_steps\/713337d7-1ce2-4878-b96b-d6531a82c226",
            "label": null,
            "isExecuted": false,
            "uuid": "d6d84652-167f-49e0-b8e0-b6ce06359fad"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Is Todays CSV Present -> Download File",
            "targetStep": "\/api\/3\/workflow_steps\/061f107c-9c52-469e-b27f-9e3bfdf3255b",
            "sourceStep": "\/api\/3\/workflow_steps\/ec0a9567-6b5b-4cfc-a111-d90b288f4063",
            "label": "Yes",
            "isExecuted": false,
            "uuid": "e8b14e01-90bf-40f1-b5cf-ed4b295086ae"
        }
    ],
    "groups": [],
    "priority": "\/api\/3\/picklists\/2b563c61-ae2c-41c0-a85a-c9709585e3f2",
    "uuid": "f2c0fed2-0328-4141-9398-377ef41304bc",
    "owners": [],
    "isPrivate": false,
    "deletedAt": null,
    "recordTags": [
        "ICS - Advisory",
        "Scheduled",
        "OT IT"
    ],
    "schedules": [
        {
            "id": "gAAAAABj9iyEslngztH9V1hB5O4fvquUAJdGmtK1nkqEcJu9EWxt_h_fqUheMYAuXbKrLh2eSl0-VaxewMczTQZ_HmNW6dBWYg==",
            "crontab": {
                "id": 9,
                "minute": "55",
                "hour": "23",
                "day_of_week": "*",
                "day_of_month": "*",
                "month_of_year": "*",
                "timezone": "UTC"
            },
            "interval": null,
            "name": "Ingest ICS Advisory",
            "task": "workflow.tasks.periodic_task",
            "args": "[]",
            "kwargs": {
                "exit_if_running": true,
                "wf_iri": "\/api\/3\/workflows\/f2c0fed2-0328-4141-9398-377ef41304bc",
                "priority": {
                    "@id": "\/api\/3\/picklists\/2b563c61-ae2c-41c0-a85a-c9709585e3f2",
                    "@type": "Picklist",
                    "itemValue": "Medium",
                    "orderIndex": 1,
                    "color": null,
                    "icon": null,
                    "listName": "\/api\/3\/picklist_names\/e104ef72-11b4-4d0c-be0e-e1cf3b87b5f2",
                    "uuid": "2b563c61-ae2c-41c0-a85a-c9709585e3f2",
                    "id": 111,
                    "importedBy": []
                },
                "createUser": "\/api\/3\/people\/3451141c-bac6-467c-8d72-85e0fab569ce",
                "name": "Ingest ICS Advisory",
                "description": "Ingest ICS Advisory",
                "auth": {
                    "auth_method": "CS HMAC"
                },
                "referenceid": null,
                "schedule_entry_name": "Ingest ICS Advisory",
                "schedule_id": "a10c2f8b-c2d1-4dd7-930c-3eda0b5204f8",
                "start_time": null,
                "expires": null
            },
            "queue": null,
            "exchange": null,
            "routing_key": null,
            "headers": "{}",
            "priority": 3,
            "expires": null,
            "expire_seconds": null,
            "one_off": false,
            "start_time": null,
            "enabled": true,
            "last_run_at": "2023-02-21T23:55:00.027529Z",
            "total_run_count": 3,
            "date_changed": "2023-02-21T23:57:30.304944Z",
            "description": "Ingest ICS Advisory",
            "solar": null,
            "clocked": null
        }
    ]
}
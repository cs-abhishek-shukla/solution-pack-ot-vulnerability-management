{
    "@type": "Workflow",
    "triggerLimit": null,
    "name": "Create ICS Advisory Record",
    "aliasName": null,
    "tag": null,
    "description": "This PB will create ICS Advisory record",
    "isActive": true,
    "debug": false,
    "singleRecordExecution": false,
    "remoteExecutableFlag": false,
    "parameters": [
        "ICSRecord"
    ],
    "synchronous": false,
    "collection": "\/api\/3\/workflow_collections\/d84beded-f595-4e73-90c4-c32992183749",
    "versions": [],
    "triggerStep": "\/api\/3\/workflow_steps\/2c7e8691-fc31-4996-aaff-61f247c91ec0",
    "steps": [
        {
            "@type": "WorkflowStep",
            "name": "Get Epoch Time",
            "description": null,
            "arguments": {
                "config": "1b5692f0-f75d-4ef6-ad85-caf587936ec7",
                "params": {
                    "python_function": "import time\nresult = {}\npattern = '%m\/%d\/%Y'\noriginal_date = {{vars.record}}.get('Original_Release_Date')\nlast_revised_date = {{vars.record}}.get('Last_Updated')\nif original_date != \"No Updates\":\n\tresult['original_date'] = int(time.mktime(time.strptime(original_date, pattern)))\nif last_revised_date != \"No Updates\":\n\tresult['last_revised_date'] = int(time.mktime(time.strptime(last_revised_date, pattern)))\nprint(result)"
                },
                "version": "2.0.3",
                "connector": "code-snippet",
                "operation": "python_inline_code_editor",
                "operationTitle": "Execute Python Code",
                "step_variables": {
                    "revisedDateEpoch": "{{vars.result.data['code_output']['last_revised_date']}}",
                    "originalDateEpoch": "{{vars.result.data['code_output']['original_date']}}"
                }
            },
            "status": null,
            "top": "300",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/1fdd14cc-d6b4-4335-a3af-ab49c8ed2fd8",
            "group": null,
            "uuid": "1c360388-156b-462c-89dd-d20010fb83a4"
        },
        {
            "@type": "WorkflowStep",
            "name": "Create ICS Record",
            "description": null,
            "arguments": {
                "resource": {
                    "year": "{{vars.record['Year']}}",
                    "cVEID": "{{vars.record['CVE_Number'].replace('\\n', ', ')}}",
                    "cWEID": "{{ vars.record['CWE_Number'].split('\\n') | join(', ')}}",
                    "vendor": "{{vars.record['Vendor']}}",
                    "iCSAUrl": "https:\/\/us-cert.cisa.gov\/\/ics\/advisories\/{{vars.record['ICS-CERT_Number'] | lower }}",
                    "product": "{{vars.record['Product']}}",
                    "__replace": "true",
                    "iCSCERTID": "{{vars.record['ICS-CERT_Number']}}",
                    "recordTags": "{{vars.finalTagList}}",
                    "sourceData": "{{vars.record | toJSON }}",
                    "lastUpdated": "{{vars.revisedDateEpoch}}",
                    "cVSSSeverity": "{{\"Severity\" | picklist(vars.record['CVSS_Severity'], \"@id\")}}",
                    "iCSCERTTitle": "{{vars.record['ICS-CERT_Advisory_Title']}}",
                    "cumulativeCVSS": "{{vars.record['Cumulative_CVSS'] | float}}",
                    "affectedProducts": "{{vars.record['Products_Affected']}}",
                    "companyHeadquarters": "{{vars.record['Company_Headquarters']}}",
                    "originalReleaseDate": "{{vars.originalDateEpoch}}",
                    "countriesAreasDeployed": "{{vars.record['Product_Distribution']}}",
                    "criticalInfrastructureSector": "{{vars.record['Critical_Infrastructure_Sector']}}"
                },
                "operation": "Overwrite",
                "collection": "\/api\/3\/upsert\/i_c_s_advisories",
                "__recommend": [],
                "ignore_errors": false,
                "fieldOperation": {
                    "recordTags": "Overwrite"
                },
                "step_variables": []
            },
            "status": null,
            "top": "840",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/2597053c-e718-44b4-8394-4d40fe26d357",
            "group": null,
            "uuid": "2083f5e2-269b-4779-aa32-07ee8e5d4b50"
        },
        {
            "@type": "WorkflowStep",
            "name": "Start",
            "description": null,
            "arguments": {
                "step_variables": {
                    "input": {
                        "params": []
                    },
                    "record": "{{vars.input.params.ICSRecord}}"
                }
            },
            "status": null,
            "top": "30",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/b348f017-9a94-471f-87f8-ce88b6a7ad62",
            "group": null,
            "uuid": "2c7e8691-fc31-4996-aaff-61f247c91ec0"
        },
        {
            "@type": "WorkflowStep",
            "name": "Remove Special Character",
            "description": null,
            "arguments": {
                "config": "be5d6cca-503d-45c0-b58e-d470e6490443",
                "params": {
                    "python_function": "import re\n\nfinalTagList = {{vars.finalTagList}}\noutput = []\ndef remove_special_characters(string):\n    return re.sub(r'[^\\w\\s]', '', string)\n\nfor tag in finalTagList:\n  new_string = remove_special_characters(tag)\n  output.append(new_string)\n\nprint(output)\n"
                },
                "version": "2.0.3",
                "connector": "code-snippet",
                "operation": "python_inline_code_editor",
                "operationTitle": "Execute Python Code",
                "step_variables": {
                    "finalTagList": "{{vars.result.data['code_output']}}"
                }
            },
            "status": null,
            "top": "705",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/1fdd14cc-d6b4-4335-a3af-ab49c8ed2fd8",
            "group": null,
            "uuid": "69aea356-60a6-4de7-a49d-4a035d6c9fcb"
        },
        {
            "@type": "WorkflowStep",
            "name": "Replace Comma",
            "description": null,
            "arguments": {
                "finalTagList": "{% set data = [] %}{% for item in vars.finalTagList %}{% if ',' in item %}{% set _ = data.append(item | replace(',', '')) %}{% else %}{% set _ = data.append(item) %}{% endif %}{% endfor %}{{data}}"
            },
            "status": null,
            "top": "30",
            "left": "475",
            "stepType": "\/api\/3\/workflow_step_types\/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
            "group": null,
            "uuid": "75cfcafe-f1c1-49dc-aebf-93958d09bc8e"
        },
        {
            "@type": "WorkflowStep",
            "name": "Configuration",
            "description": null,
            "arguments": {
                "sector": "{{vars.record['Critical_Infrastructure_Sector'] | replace(';', ',') | replace(',,',  ',')}}",
                "vendor": "{{vars.record['Vendor'] | replace('\\'', '')}}",
                "tagList": "[]"
            },
            "status": null,
            "top": "165",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
            "group": null,
            "uuid": "85f68f5e-c615-4c6b-ba6a-1e083f4fa3c3"
        },
        {
            "@type": "WorkflowStep",
            "name": "Final Tag List",
            "description": null,
            "arguments": {
                "finalTagList": "{% set _ = vars.sectorTagList.append(vars.vendor) %}{{vars.sectorTagList}}"
            },
            "status": null,
            "top": "570",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
            "group": null,
            "uuid": "9745270a-1972-4796-b748-b5809e6395d9"
        },
        {
            "@type": "WorkflowStep",
            "name": "Add Sector Tag In List",
            "description": null,
            "arguments": {
                "sectorTagList": "{% set _ = vars.tagList.append(vars.sector.split(',')) %}{{vars.tagList | flatten}}"
            },
            "status": null,
            "top": "435",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
            "group": null,
            "uuid": "d07ac72b-83a1-4794-9d6a-bbb0426af805"
        },
        {
            "@type": "WorkflowStep",
            "name": "Replace Forward Slace",
            "description": null,
            "arguments": {
                "finalTagList": "{{vars.finalTagList | replace('\/', '-') }}"
            },
            "status": null,
            "top": "165",
            "left": "475",
            "stepType": "\/api\/3\/workflow_step_types\/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
            "group": null,
            "uuid": "f10a9833-7e47-4834-a485-86b5159ff40b"
        }
    ],
    "routes": [
        {
            "@type": "WorkflowRoute",
            "name": "Configuration -> Get Epoch Time",
            "targetStep": "\/api\/3\/workflow_steps\/1c360388-156b-462c-89dd-d20010fb83a4",
            "sourceStep": "\/api\/3\/workflow_steps\/85f68f5e-c615-4c6b-ba6a-1e083f4fa3c3",
            "label": null,
            "isExecuted": false,
            "uuid": "0d5aa978-dfed-458f-b9ad-332b4b53f001"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Get Epoch Time -> Add Sector Tag In List",
            "targetStep": "\/api\/3\/workflow_steps\/d07ac72b-83a1-4794-9d6a-bbb0426af805",
            "sourceStep": "\/api\/3\/workflow_steps\/1c360388-156b-462c-89dd-d20010fb83a4",
            "label": null,
            "isExecuted": false,
            "uuid": "361d5e67-6265-4cbe-911e-ec9170fdf997"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Configuration -> Flatten List",
            "targetStep": "\/api\/3\/workflow_steps\/9745270a-1972-4796-b748-b5809e6395d9",
            "sourceStep": "\/api\/3\/workflow_steps\/d07ac72b-83a1-4794-9d6a-bbb0426af805",
            "label": null,
            "isExecuted": false,
            "uuid": "388ca100-e969-4946-9412-206cde2ed545"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Replace Comma -> Replace Forward Slace",
            "targetStep": "\/api\/3\/workflow_steps\/f10a9833-7e47-4834-a485-86b5159ff40b",
            "sourceStep": "\/api\/3\/workflow_steps\/75cfcafe-f1c1-49dc-aebf-93958d09bc8e",
            "label": null,
            "isExecuted": false,
            "uuid": "5e06ef2f-54d9-40c5-921e-efe3ebf31ed0"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Final Tag List -> Remove Special Character",
            "targetStep": "\/api\/3\/workflow_steps\/69aea356-60a6-4de7-a49d-4a035d6c9fcb",
            "sourceStep": "\/api\/3\/workflow_steps\/9745270a-1972-4796-b748-b5809e6395d9",
            "label": null,
            "isExecuted": false,
            "uuid": "bf0966a9-50c8-48d6-b541-0684df99a5bd"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Remove Special Character -> Create ICS Record",
            "targetStep": "\/api\/3\/workflow_steps\/2083f5e2-269b-4779-aa32-07ee8e5d4b50",
            "sourceStep": "\/api\/3\/workflow_steps\/69aea356-60a6-4de7-a49d-4a035d6c9fcb",
            "label": null,
            "isExecuted": false,
            "uuid": "d179bc31-3081-493c-a49c-e01fa8447177"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Start -> Configuration",
            "targetStep": "\/api\/3\/workflow_steps\/85f68f5e-c615-4c6b-ba6a-1e083f4fa3c3",
            "sourceStep": "\/api\/3\/workflow_steps\/2c7e8691-fc31-4996-aaff-61f247c91ec0",
            "label": null,
            "isExecuted": false,
            "uuid": "fdf4834f-cf8f-48d1-923e-4fb71b35fd96"
        }
    ],
    "groups": [],
    "priority": "\/api\/3\/picklists\/2b563c61-ae2c-41c0-a85a-c9709585e3f2",
    "uuid": "aca28040-bac9-45fe-969f-1d916035a28d",
    "owners": [],
    "isPrivate": false,
    "deletedAt": null,
    "recordTags": [
        "Advisory",
        "ICS",
        "OT IT"
    ]
}
{
    "@type": "Workflow",
    "triggerLimit": null,
    "name": "Get And Update CVE",
    "aliasName": null,
    "tag": null,
    "description": "This PB will get CEV report from NVD and will update record",
    "isActive": true,
    "debug": false,
    "singleRecordExecution": false,
    "remoteExecutableFlag": false,
    "parameters": [
        "CVERecord"
    ],
    "synchronous": false,
    "collection": "\/api\/3\/workflow_collections\/d84beded-f595-4e73-90c4-c32992183749",
    "versions": [],
    "triggerStep": "\/api\/3\/workflow_steps\/c4ec48ec-7113-4fb7-9608-bd503b4c2bf9",
    "steps": [
        {
            "@type": "WorkflowStep",
            "name": "Create CVE Record",
            "description": null,
            "arguments": {
                "when": "{{vars.CVEData | length > 0}}",
                "arguments": {
                    "cVEsRecord": "{{vars.CVEData[0]}}"
                },
                "apply_async": false,
                "ignore_errors": false,
                "step_variables": {
                    "output": "{{vars.result}}"
                },
                "pass_parent_env": false,
                "pass_input_record": false,
                "workflowReference": "\/api\/3\/workflows\/8480ac2e-a420-49ed-adc7-8a71b2a9583c"
            },
            "status": null,
            "top": "30",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/74932bdc-b8b6-4d24-88c4-1a4dfbc524f3",
            "group": null,
            "uuid": "16c06753-6689-431e-8da4-746ae3a19f85"
        },
        {
            "@type": "WorkflowStep",
            "name": "Get CVE by ID",
            "description": null,
            "arguments": {
                "name": "NIST National Vulnerability Database",
                "config": "09666536-d2b4-4833-adf3-5df2d57b8e2b",
                "params": {
                    "cveId": "{{vars.record['cVEID']}}"
                },
                "version": "1.1.0",
                "connector": "nist-nvd",
                "operation": "get_specific_cve_details",
                "ignore_errors": false,
                "operationTitle": "Get Specific CVE ID Details",
                "pickFromTenant": false,
                "step_variables": {
                    "CVEData": "{{vars.result.data.vulnerabilities}}"
                }
            },
            "status": null,
            "top": "300",
            "left": "475",
            "stepType": "\/api\/3\/workflow_step_types\/0bfed618-0316-11e7-93ae-92361f002671",
            "group": null,
            "uuid": "35ecf89d-278b-4d1b-9dbe-a2e984fa2ab0"
        },
        {
            "@type": "WorkflowStep",
            "name": "Configuration",
            "description": null,
            "arguments": {
                "record": "{{vars.input.params.CVERecord}}"
            },
            "status": null,
            "top": "165",
            "left": "475",
            "stepType": "\/api\/3\/workflow_step_types\/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
            "group": null,
            "uuid": "4126b601-fd04-4d00-81bc-1c60a6c332b3"
        },
        {
            "@type": "WorkflowStep",
            "name": "Output",
            "description": null,
            "arguments": {
                "results": "{% set output = ({\"uuid\":vars.record['uuid'], \"cVEId\":vars.record['cVEID']}) %}{% if vars.CVEData | length > 0 %}{% set _ = output.update({\"status\": \"Found\"}) %}{% else %}{% set _ = output.update({\"status\": \"Not Found\"}) %}{% endif %}{{output}}"
            },
            "status": null,
            "top": "570",
            "left": "475",
            "stepType": "\/api\/3\/workflow_step_types\/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
            "group": null,
            "uuid": "4dc7573d-0861-44f4-b254-f5f040f89a24"
        },
        {
            "@type": "WorkflowStep",
            "name": "Update CVE",
            "description": null,
            "arguments": {
                "when": "{{vars.CVEData | length > 0}}",
                "resource": {
                    "cWEID": "{% if vars.CVEData[0].cve.get(\"weaknesses\", \"\") != \"\" %}{% set cwe = vars.CVEData[0].cve['weaknesses'] | json_query(\"[*][description][][][value][]\") | unique %}{{cwe | join(', ')}}{% endif %}",
                    "__link": {
                        "recordTags": "{% if (vars.CVEData[0].cve.keys() | string | regex_findall('cisa')) %}{{\"KEV\"}}{% endif %}"
                    },
                    "cVEURL": "https:\/\/nvd.nist.gov\/vuln\/detail\/{{vars.CVEData[0].cve['id']}}",
                    "cVSSv2": "{% if  (vars.CVEData[0].cve.metrics.keys() | string | regex_findall('cvssMetricV2'))[0] %}\n| Source | Base Score | Vector |\n| --- | --- | --- |{% for item in vars.CVEData[0].cve['metrics']['cvssMetricV2'] %}\n| {{item.source}} | <span data-tomark-pass=\"\" style=color:{{\"Severity\" | picklist(item.baseSeverity, \"color\")}}>{{item.cvssData.baseScore}} <\/span>| {{item.cvssData.vectorString}} |{% endfor %}{% endif %}\n",
                    "cVSSv3": "{% if  (vars.CVEData[0].cve.metrics.keys() | string | regex_findall('cvssMetricV3[0-9]'))[0] %}\n{% set  version = (vars.CVEData[0].cve.metrics.keys() | string | regex_findall('cvssMetricV3[0-9]'))[0] %}\n| Source | Base Score | Vector |\n| --- | --- | --- |{% for item in vars.CVEData[0].cve.metrics.get(version) %}\n| {{item.source}} | <span data-tomark-pass=\"\" style=color:{{\"Severity\" | picklist(item.cvssData.baseSeverity, \"color\")}}>{{item.cvssData.baseScore}} <\/span>| {{item.cvssData.vectorString}} |{% endfor %}{% endif %}\n",
                    "reference": "{% if vars.CVEData[0].cve['references'] %}\n| Hyperlink | Tags | Source |\n| --- | --- | --- |{% for item in vars.CVEData[0].cve['references'] %}\n| <a href=\"{{item.url}}\">{{item.url}}<\/a> | {{item.tags | join(', ')}} | {{item.source}} |{% endfor %}{% endif %}",
                    "cPEsDetail": "{% if vars.CVEData[0].cve.configurations[0]['nodes'][0]['cpeMatch'] %}\n| CPE Name | Is Vulnerable | Match Id |\n| --- | --- | --- |{% for item in vars.CVEData[0].cve.configurations[0]['nodes'][0]['cpeMatch'] %}\n| {{item.criteria}} | {{item.vulnerable}} | {{item.matchCriteriaId}} |{% endfor %}{% endif %}",
                    "sourceData": "{{vars.CVEData[0].cve | toJSON }}",
                    "description": "{{(vars.CVEData[0].cve.descriptions  | json_query(\"[?lang == 'en'].value\"))[0] }}",
                    "kEVTagSource": "\/api\/3\/picklists\/b5492d79-fe49-43ab-9786-f8e60fc12204",
                    "publishedDate": "{{arrow.get(vars.CVEData[0].cve['published']).int_timestamp}}",
                    "isInKEVCatalog": "{% if (vars.CVEData[0].cve.keys() | string | regex_findall('cisa')) %}{{\"YesNoInput\" | picklist(\"Yes\", \"@id\")}}{% else %}{{\"YesNoInput\" | picklist(\"No\", \"@id\")}}{% endif %}",
                    "lastModifiedOn": "{{arrow.get(vars.CVEData[0].cve['lastModified']).int_timestamp}}",
                    "evaluatorImpact": "{{vars.CVEData[0].cve['evaluatorImpact']}}",
                    "identifierSource": "{{vars.CVEData[0].cve.sourceIdentifier}}",
                    "vendorStatements": "{% if 'vendorComments' in vars.CVEData[0].cve %}\n[Vendor Statements](https:\/\/nvd.nist.gov\/vuln\/vendor-comments)\n\n{% for item in vars.CVEData[0].cve['vendorComments'] %}\n<p><h5>{{item.organization}} ({{item.lastModified.split('T')[0] }}) <\/h5>&emsp;{{item.comment}}<\/p>\n{% endfor %}\n{% endif %}\n",
                    "evaluatorSolution": "{{vars.CVEData[0].cve['evaluatorImpact']}}",
                    "vulnerabilityStatus": "{{\"CVEVulnerabilityStatus\" | picklist(vars.CVEData[0].cve['vulnStatus'], \"@id\")}}"
                },
                "operation": "Append",
                "collection": "{{vars.record['@id']}}",
                "__recommend": [],
                "collectionType": "\/api\/3\/c_v_es",
                "fieldOperation": {
                    "recordTags": "Append"
                },
                "step_variables": []
            },
            "status": null,
            "top": "435",
            "left": "475",
            "stepType": "\/api\/3\/workflow_step_types\/b593663d-7d13-40ce-a3a3-96dece928722",
            "group": null,
            "uuid": "7cdae58e-6005-453b-8fb2-569de37f0b57"
        },
        {
            "@type": "WorkflowStep",
            "name": "Start",
            "description": null,
            "arguments": {
                "step_variables": {
                    "input": {
                        "params": []
                    }
                }
            },
            "status": null,
            "top": "30",
            "left": "475",
            "stepType": "\/api\/3\/workflow_step_types\/b348f017-9a94-471f-87f8-ce88b6a7ad62",
            "group": null,
            "uuid": "c4ec48ec-7113-4fb7-9608-bd503b4c2bf9"
        }
    ],
    "routes": [
        {
            "@type": "WorkflowRoute",
            "name": "Get CVE by ID -> Update CVE",
            "targetStep": "\/api\/3\/workflow_steps\/7cdae58e-6005-453b-8fb2-569de37f0b57",
            "sourceStep": "\/api\/3\/workflow_steps\/35ecf89d-278b-4d1b-9dbe-a2e984fa2ab0",
            "label": null,
            "isExecuted": false,
            "uuid": "1657d920-367e-4d6d-9979-d3c0a30b3b7c"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Start -> Configuration",
            "targetStep": "\/api\/3\/workflow_steps\/4126b601-fd04-4d00-81bc-1c60a6c332b3",
            "sourceStep": "\/api\/3\/workflow_steps\/c4ec48ec-7113-4fb7-9608-bd503b4c2bf9",
            "label": null,
            "isExecuted": false,
            "uuid": "6f5e5de7-0385-4d63-ad1b-d633c26cdb31"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Configuration -> Get CVE by ID",
            "targetStep": "\/api\/3\/workflow_steps\/35ecf89d-278b-4d1b-9dbe-a2e984fa2ab0",
            "sourceStep": "\/api\/3\/workflow_steps\/4126b601-fd04-4d00-81bc-1c60a6c332b3",
            "label": null,
            "isExecuted": false,
            "uuid": "829f2d64-f5ae-4864-a361-3891affefead"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Update CVE -> Output",
            "targetStep": "\/api\/3\/workflow_steps\/4dc7573d-0861-44f4-b254-f5f040f89a24",
            "sourceStep": "\/api\/3\/workflow_steps\/7cdae58e-6005-453b-8fb2-569de37f0b57",
            "label": null,
            "isExecuted": false,
            "uuid": "f07f7e27-67c2-48f3-9db1-8b3a2702badd"
        }
    ],
    "groups": [],
    "priority": "\/api\/3\/picklists\/2b563c61-ae2c-41c0-a85a-c9709585e3f2",
    "uuid": "74d37cd4-263a-4685-844d-7d73a4b803dd",
    "owners": [],
    "isPrivate": false,
    "deletedAt": null,
    "recordTags": [
        "CVE",
        "OT IT",
        "Update",
        "KEV",
        "Alert"
    ]
}
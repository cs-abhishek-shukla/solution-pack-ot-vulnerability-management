{
    "@type": "Workflow",
    "triggerLimit": null,
    "name": "Calculate SSVC Score",
    "aliasName": null,
    "tag": null,
    "description": "Update SSVC Score for each KEV CVE.",
    "isActive": true,
    "debug": false,
    "singleRecordExecution": false,
    "remoteExecutableFlag": false,
    "parameters": [],
    "synchronous": false,
    "collection": "\/api\/3\/workflow_collections\/db7036e6-4e35-4479-beea-d7fefc73ab68",
    "versions": [],
    "triggerStep": "\/api\/3\/workflow_steps\/bf237623-8d4e-4b9a-bfaa-5fa6e078d14c",
    "steps": [
        {
            "@type": "WorkflowStep",
            "name": "Incomplete Tasks",
            "description": null,
            "arguments": {
                "type": "InputBased",
                "input": {
                    "schema": {
                        "title": "List Of KEV CVEs according to there Task Status",
                        "description": "<h6>Please complete pending tasks to calculate SSVC Score:<\/h6>\n<hr>\n{% for item in (vars.results  | json_query(\"[?statusMessage == 'Completed']\"))%}<li><a href=\"\/modules\/c_v_es\/{{item.CVEIRI.split('\/')[-1]}}\" target=\"_blank\" rel=\"noopener\">{{( item.CVEIRI | fromIRI).cVEID }}<\/a> <span class=\"badge badge-pill badge-danger\" style=\"background: #009d00; color: #fff;\">{{item.statusMessage}}<\/span><\/li>{% endfor %}<br>\n{% for item in (vars.results  | json_query(\"[?statusMessage == 'Pending']\"))%}<li><a href=\"\/modules\/c_v_es\/{{item.CVEIRI.split('\/')[-1]}}\" target=\"_blank\" rel=\"noopener\">{{( item.CVEIRI | fromIRI).cVEID }}<\/a><span class=\"badge badge-pill badge-danger\" style=\"background: #f7ac20; color: #fff;\">{{item.statusMessage}}<\/span> {% for data in item.IRI %}<ul><li><a href=\"\/modules\/tasks\/{{data.split('\/')[-1]}}\" target=\"_blank\" rel=\"noopener\">{{(data | fromIRI).name}}<\/a><\/li><\/ul>{% endfor %}<\/li>{% endfor %}\n\n\n",
                        "inputVariables": []
                    }
                },
                "record": "{{ vars.input.records[0][\"@id\"] }}",
                "agent_id": null,
                "resources": "k_e_v_alerts",
                "owner_detail": {
                    "isAssigned": true,
                    "assignedToTeam": [],
                    "assignedToField": "assignedTo",
                    "assignedToPerson": [],
                    "assignedToRecord": false
                },
                "isRecordLinked": true,
                "step_variables": [],
                "response_mapping": {
                    "options": [
                        {
                            "option": "Ok",
                            "primary": true,
                            "step_iri": "\/api\/3\/workflow_steps\/d5bf53dc-4fb6-4afb-8416-f365f3727ce4"
                        }
                    ],
                    "duplicateOption": false
                },
                "email_notification": {
                    "enabled": false,
                    "smtpParameters": []
                },
                "inline_channel_list": [],
                "external_channel_list": [],
                "unauthenticated_input": false
            },
            "status": null,
            "top": "570",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/fc04082a-d7dc-4299-96fb-6837b1baa0fe",
            "group": null,
            "uuid": "02ac782b-3e4c-4471-9555-91f1979f984b"
        },
        {
            "@type": "WorkflowStep",
            "name": "Get CVEs SSVC SCore",
            "description": null,
            "arguments": {
                "for_each": {
                    "item": "{{vars.steps.Get_CVE_And_ICS_Advisory[0].cVEs}}",
                    "parallel": false,
                    "condition": "{{vars.item.isInKEVCatalog != \"\/api\/3\/picklists\/711303d3-75ea-437d-a871-0a8d14fcdb7d\"}}"
                },
                "arguments": {
                    "cVERecord": "{{vars.item}}",
                    "iCSAdvisoryID": "{{vars.steps.Get_CVE_And_ICS_Advisory[0].iCSAdvisories[0]['iCSCERTID']}}"
                },
                "apply_async": false,
                "step_variables": {
                    "results": "{{vars.steps.Get_CVEs_SSVC_SCore | json_query(\"[*][output][]\")}}"
                },
                "pass_parent_env": false,
                "pass_input_record": false,
                "workflowReference": "\/api\/3\/workflows\/a99bc56f-cd58-4703-b4a9-93f4e0f6236b"
            },
            "status": null,
            "top": "300",
            "left": "300",
            "stepType": "\/api\/3\/workflow_step_types\/74932bdc-b8b6-4d24-88c4-1a4dfbc524f3",
            "group": null,
            "uuid": "5dc92876-cc18-4cd8-b64c-61f51bfb54a0"
        },
        {
            "@type": "WorkflowStep",
            "name": "Incomplete Task Exists",
            "description": null,
            "arguments": {
                "conditions": [
                    {
                        "option": "Yes",
                        "step_iri": "\/api\/3\/workflow_steps\/02ac782b-3e4c-4471-9555-91f1979f984b",
                        "condition": "{{ 'Pending' in vars.results | json_query('[*][statusMessage][]') }}",
                        "step_name": "Copy of Incomplete Tasks"
                    },
                    {
                        "option": "No",
                        "default": true,
                        "step_iri": "\/api\/3\/workflow_steps\/fad0a108-6a9b-4dbd-a77e-bf810795a2b8",
                        "step_name": "Copy of Calculation Message"
                    }
                ]
            },
            "status": null,
            "top": "435",
            "left": "300",
            "stepType": "\/api\/3\/workflow_step_types\/12254cf5-5db7-4b1a-8cb1-3af081924b28",
            "group": null,
            "uuid": "8710cff1-3ecf-44df-b027-a8d60589398a"
        },
        {
            "@type": "WorkflowStep",
            "name": "Update KEV Alert",
            "description": null,
            "arguments": {
                "resource": {
                    "vulnerabilityAssignment": "<p style=\"text-align: justify;\">{% for item in vars.results %}<\/p>\n<h6><span style=\"text-decoration: underline;\"> <span style=\"fill: {{item['SSVCColor']}};\">{{(item.CVEIRI | fromIRI).cVEID}}<\/span> <\/span><\/h6>\n<p><svg width=\"1100\" height=\"70\"> <g> <circle style=\"fill: #b0c4de; stroke: #3598db;\" r=\"10\" cy=\"55\" cx=\"20\"><\/circle> <text style=\"font-size: 15px; fill: #3598db;\" y=\"30\" x=\"0\">Exploitation<\/text> <path style=\"stroke: #3598db; stroke-width: 2;\" d=\"M 30,55 C 30,55 30,55 240,55\" id=\"chk1\"><\/path> <text text-anchor=\"middle\" dx=\"120\" dy=\"48\" style=\"stroke: #3598db;\"> {{item['SSVC']['Exploitation'] | lower}} <\/text> <\/g> <g> <circle style=\"fill: #b0c4de; stroke: #3598db;\" r=\"10\" cy=\"55\" cx=\"240\"><\/circle> <text style=\"font-size: 15px; fill: #3598db;\" y=\"30\" x=\"200\">Automatable<\/text> <path style=\"stroke: #3598db; stroke-width: 2;\" d=\"M 250,55 C 250,55 250,55 460,55\" id=\"chk2\"><\/path> <text text-anchor=\"middle\" dx=\"340\" dy=\"48\" style=\"stroke: #3598db;\"> {{item['SSVC']['Automatable'] | lower}} <\/text> <\/g> <g> <circle style=\"fill: #b0c4de; stroke: #3598db;\" r=\"10\" cy=\"55\" cx=\"460\"><\/circle> <text style=\"font-size: 15px; fill: #3598db;\" y=\"30\" x=\"410\">Technical Impact <\/text> <path style=\"stroke: #3598db; stroke-width: 2;\" d=\"M 470,55 C 470,55 470,55 680,55\" id=\"chk3\"><\/path> <text text-anchor=\"middle\" dx=\"560\" dy=\"48\" style=\"stroke: #3598db;\"> {{item['SSVC']['Technical Impact'] | lower}} <\/text> <\/g> <g> <circle style=\"fill: #b0c4de; stroke: #3598db;\" r=\"10\" cy=\"55\" cx=\"680\"><\/circle> <text style=\"font-size: 15px; fill: #3598db;\" y=\"30\" x=\"620\">Mission &amp; Well-being <\/text> <path style=\"stroke: #3598db; stroke-width: 2;\" d=\"M 690,55 C 690,55 690,55 900,55\" id=\"chk4\"><\/path> <text text-anchor=\"middle\" dx=\"780\" dy=\"48\" style=\"stroke: #3598db;\"> {{(item['SSVCResult']) | lower}} <\/text> <\/g> <g> <circle style=\"fill: {{item['SSVCColor']}};\" r=\"10\" cy=\"55\" cx=\"900\"><\/circle> <text style=\"font-size: 15px; fill: {{item['SSVCColor']}};\" y=\"50\" x=\"915\">{{item['FinalOutput']}} <\/text> <\/g> <\/svg><\/p>\n<h6><span style=\"text-decoration: underline; color: #e67e23;\"> <span style=\"font-size: 10pt;\">Vulnerability Scoring Decision<\/span> <\/span><\/h6>\n<h6><span style=\"font-size: 10pt; color: {{item['ssvccolor']}};\">{{item['FinalOutput']}}: {{item['SSVCText']}}<\/span><\/h6>\n<p>{% endfor %}<\/p>"
                },
                "operation": "Append",
                "collection": "{{vars.input.records[0]['@id']}}",
                "__recommend": [],
                "collectionType": "\/api\/3\/k_e_v_alerts",
                "fieldOperation": {
                    "recordTags": "Append"
                },
                "step_variables": []
            },
            "status": null,
            "top": "705",
            "left": "475",
            "stepType": "\/api\/3\/workflow_step_types\/b593663d-7d13-40ce-a3a3-96dece928722",
            "group": null,
            "uuid": "b08ba562-c643-45dd-8bbc-c1b9fa875d99"
        },
        {
            "@type": "WorkflowStep",
            "name": "Start",
            "description": null,
            "arguments": {
                "route": "99f35126-5bda-4144-ac3e-f434882a5234",
                "resources": [
                    "k_e_v_alerts"
                ],
                "inputVariables": [],
                "step_variables": {
                    "input": {
                        "params": [],
                        "records": "{{vars.input.records}}"
                    }
                },
                "displayConditions": {
                    "tasks": {
                        "sort": [],
                        "limit": 30,
                        "logic": "AND",
                        "filters": []
                    },
                    "c_v_es": {
                        "sort": [],
                        "limit": 30,
                        "logic": "AND",
                        "filters": []
                    },
                    "k_e_v_alerts": {
                        "sort": [],
                        "limit": 30,
                        "logic": "AND",
                        "filters": []
                    },
                    "mitre_mitigations": {
                        "sort": [],
                        "limit": 30,
                        "logic": "AND",
                        "filters": []
                    }
                },
                "executeButtonText": "Execute",
                "noRecordExecution": false,
                "singleRecordExecution": true
            },
            "status": null,
            "top": "30",
            "left": "300",
            "stepType": "\/api\/3\/workflow_step_types\/f414d039-bb0d-4e59-9c39-a8f1e880b18a",
            "group": null,
            "uuid": "bf237623-8d4e-4b9a-bfaa-5fa6e078d14c"
        },
        {
            "@type": "WorkflowStep",
            "name": "Get CVE And ICS Advisory",
            "description": null,
            "arguments": {
                "query": {
                    "sort": [],
                    "limit": 30,
                    "logic": "AND",
                    "filters": [
                        {
                            "type": "primitive",
                            "field": "id",
                            "value": "{{vars.input.records[0].id}}",
                            "operator": "eq",
                            "_operator": "eq"
                        }
                    ],
                    "__selectFields": [
                        "cVEs",
                        "iCSAdvisories"
                    ]
                },
                "module": "k_e_v_alerts?$limit=30&$relationships=true&$fsr_max_relation_count=100",
                "checkboxFields": true,
                "step_variables": []
            },
            "status": null,
            "top": "165",
            "left": "300",
            "stepType": "\/api\/3\/workflow_step_types\/b593663d-7d13-40ce-a3a3-96dece928770",
            "group": null,
            "uuid": "c53b301c-9438-479f-abe7-c836a4621ffb"
        },
        {
            "@type": "WorkflowStep",
            "name": "Calculation Message",
            "description": null,
            "arguments": {
                "type": "InputBased",
                "input": {
                    "schema": {
                        "title": "Stakeholder Specific Vulnerability Categorization (SSVC)",
                        "description": "<h5>The assigned tasks have been completed. The <i>Evaluation<\/i> tab will contains SSVC Score for KEV CVEs.<\/h5>",
                        "inputVariables": []
                    }
                },
                "record": "{{ vars.input.records[0][\"@id\"] }}",
                "agent_id": null,
                "resources": "k_e_v_alerts",
                "owner_detail": {
                    "isAssigned": false
                },
                "isRecordLinked": true,
                "step_variables": [],
                "response_mapping": {
                    "options": [
                        {
                            "option": "Ok",
                            "primary": true,
                            "step_iri": "\/api\/3\/workflow_steps\/b08ba562-c643-45dd-8bbc-c1b9fa875d99"
                        }
                    ],
                    "duplicateOption": false
                },
                "email_notification": {
                    "enabled": false,
                    "smtpParameters": []
                },
                "inline_channel_list": [],
                "external_channel_list": [],
                "unauthenticated_input": false
            },
            "status": null,
            "top": "570",
            "left": "475",
            "stepType": "\/api\/3\/workflow_step_types\/fc04082a-d7dc-4299-96fb-6837b1baa0fe",
            "group": null,
            "uuid": "fad0a108-6a9b-4dbd-a77e-bf810795a2b8"
        }
    ],
    "routes": [
        {
            "@type": "WorkflowRoute",
            "name": "Incomplete Task Exists -> Copy of Calculation Message",
            "targetStep": "\/api\/3\/workflow_steps\/fad0a108-6a9b-4dbd-a77e-bf810795a2b8",
            "sourceStep": "\/api\/3\/workflow_steps\/8710cff1-3ecf-44df-b027-a8d60589398a",
            "label": "No",
            "isExecuted": false,
            "uuid": "03134435-5fb4-4360-a815-3081409690c1"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Copy of Calculation Message -> Copy of Update KEV Alert",
            "targetStep": "\/api\/3\/workflow_steps\/b08ba562-c643-45dd-8bbc-c1b9fa875d99",
            "sourceStep": "\/api\/3\/workflow_steps\/fad0a108-6a9b-4dbd-a77e-bf810795a2b8",
            "label": "Ok",
            "isExecuted": false,
            "uuid": "39623f97-a044-42ef-8ea0-2c1f52addf59"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Incomplete Task Exists -> Copy of Incomplete Tasks",
            "targetStep": "\/api\/3\/workflow_steps\/02ac782b-3e4c-4471-9555-91f1979f984b",
            "sourceStep": "\/api\/3\/workflow_steps\/8710cff1-3ecf-44df-b027-a8d60589398a",
            "label": "Yes",
            "isExecuted": false,
            "uuid": "3feb1ae2-b028-4fd4-90a8-3f3ec7fb4009"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Get CVEs SSVC SCore -> Incomplete Task Exists",
            "targetStep": "\/api\/3\/workflow_steps\/8710cff1-3ecf-44df-b027-a8d60589398a",
            "sourceStep": "\/api\/3\/workflow_steps\/5dc92876-cc18-4cd8-b64c-61f51bfb54a0",
            "label": null,
            "isExecuted": false,
            "uuid": "4cee530a-0239-4fe8-8be8-5fc4f21bfdd5"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Start -> Get CVE And ICS Advisory",
            "targetStep": "\/api\/3\/workflow_steps\/c53b301c-9438-479f-abe7-c836a4621ffb",
            "sourceStep": "\/api\/3\/workflow_steps\/bf237623-8d4e-4b9a-bfaa-5fa6e078d14c",
            "label": null,
            "isExecuted": false,
            "uuid": "80d98388-f885-4ba9-9eae-e72e6b037332"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Get CVE And ICS Advisory -> Get CVEs SSVC SCore",
            "targetStep": "\/api\/3\/workflow_steps\/5dc92876-cc18-4cd8-b64c-61f51bfb54a0",
            "sourceStep": "\/api\/3\/workflow_steps\/c53b301c-9438-479f-abe7-c836a4621ffb",
            "label": null,
            "isExecuted": false,
            "uuid": "e4059050-d6f9-42bb-809c-f18b372a112b"
        }
    ],
    "groups": [],
    "priority": "\/api\/3\/picklists\/2b563c61-ae2c-41c0-a85a-c9709585e3f2",
    "uuid": "e2e5cf31-e7ec-4216-8a9e-2d02d31b88fe",
    "owners": [],
    "isPrivate": false,
    "deletedAt": null,
    "recordTags": [
        "Alert",
        "Calculate",
        "CVE",
        "ICS - Advisory",
        "KEV",
        "SSVC",
        "Tasks",
        "OT IT",
        "SSVC - Score"
    ]
}